{"version":3,"file":"regltf.js","sources":["../lib/pools.js","../lib/resl.js","../lib/builtin-programs.js","../lib/builtin-techniques.js","../lib/loader.js","../lib/build-cmd-data.js","../index.js"],"sourcesContent":["import { FramePool } from 'memop';\n\nexport let f32a_m4_pool = new FramePool(function() {\n  return new Float32Array(16);\n}, 256);","/**\n * (c) 2016 Mikola Lysenko. MIT License\n * https://github.com/regl-project/resl\n */\n\n'use strict';\n\n/* global XMLHttpRequest */\nconst configParameters = [\n  'manifest',\n  'onDone',\n  'onProgress',\n  'onError'\n];\n\nconst manifestParameters = [\n  'type',\n  'src',\n  'stream',\n  'credentials',\n  'parser'\n];\n\nconst parserParameters = [\n  'onData',\n  'onDone'\n];\n\nconst STATE_ERROR = -1;\nconst STATE_DATA = 0;\nconst STATE_COMPLETE = 1;\n\nfunction raise(message) {\n  throw new Error('resl: ' + message);\n}\n\nfunction checkType(object, parameters, name) {\n  Object.keys(object).forEach(function (param) {\n    if (parameters.indexOf(param) < 0) {\n      raise('invalid parameter \"' + param + '\" in ' + name);\n    }\n  });\n}\n\nfunction Loader(name, cancel) {\n  this.state = STATE_DATA;\n  this.ready = false;\n  this.progress = 0;\n  this.name = name;\n  this.cancel = cancel;\n}\n\nexport default function resl(config) {\n  if (typeof config !== 'object' || !config) {\n    raise('invalid or missing configuration');\n  }\n\n  checkType(config, configParameters, 'config');\n\n  let manifest = config.manifest;\n  if (typeof manifest !== 'object' || !manifest) {\n    raise('missing manifest');\n  }\n\n  function getFunction(name) {\n    if (name in config) {\n      let func = config[name];\n      if (typeof func !== 'function') {\n        raise('invalid callback \"' + name + '\"');\n      }\n      return func;\n    }\n    return null;\n  }\n\n  let onDone = getFunction('onDone');\n  if (!onDone) {\n    raise('missing onDone() callback');\n  }\n\n  let onProgress = getFunction('onProgress');\n  let onError = getFunction('onError');\n\n  let assets = {};\n\n  let state = STATE_DATA;\n\n  function loadXHR(request) {\n    let name = request.name;\n    let stream = request.stream;\n    let binary = request.type === 'binary';\n    let parser = request.parser;\n\n    let xhr = new XMLHttpRequest();\n    let asset = null;\n\n    let loader = new Loader(name, cancel);\n\n    if (stream) {\n      xhr.onreadystatechange = onReadyStateChange;\n    } else {\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4) {\n          onReadyStateChange();\n        }\n      };\n    }\n\n    if (binary) {\n      xhr.responseType = 'arraybuffer';\n    }\n\n    function onReadyStateChange() {\n      if (xhr.readyState < 2 ||\n        loader.state === STATE_COMPLETE ||\n        loader.state === STATE_ERROR) {\n        return;\n      }\n      if (xhr.status !== 200) {\n        return abort('error loading resource \"' + request.name + '\"');\n      }\n      if (xhr.readyState > 2 && loader.state === STATE_DATA) {\n        let response;\n        if (request.type === 'binary') {\n          response = xhr.response;\n        } else {\n          response = xhr.responseText;\n        }\n        if (parser.data) {\n          try {\n            asset = parser.data(response);\n          } catch (e) {\n            return abort(e);\n          }\n        } else {\n          asset = response;\n        }\n      }\n      if (xhr.readyState > 3 && loader.state === STATE_DATA) {\n        if (parser.done) {\n          try {\n            asset = parser.done();\n          } catch (e) {\n            return abort(e);\n          }\n        }\n        loader.state = STATE_COMPLETE;\n      }\n      assets[name] = asset;\n      loader.progress = 0.75 * loader.progress + 0.25;\n      loader.ready =\n        (request.stream && !!asset) ||\n        loader.state === STATE_COMPLETE;\n      notifyProgress();\n    }\n\n    function cancel() {\n      if (loader.state === STATE_COMPLETE || loader.state === STATE_ERROR) {\n        return;\n      }\n      xhr.onreadystatechange = null;\n      xhr.abort();\n      loader.state = STATE_ERROR;\n    }\n\n    // set up request\n    if (request.credentials) {\n      xhr.withCredentials = true;\n    }\n    xhr.open('GET', request.src, true);\n    xhr.send();\n\n    return loader;\n  }\n\n  function loadElement(request, element) {\n    let name = request.name;\n    let parser = request.parser;\n\n    let loader = new Loader(name, cancel);\n    let asset = element;\n\n    function handleProgress() {\n      if (loader.state === STATE_DATA) {\n        if (parser.data) {\n          try {\n            asset = parser.data(element);\n          } catch (e) {\n            return abort(e);\n          }\n        } else {\n          asset = element;\n        }\n      }\n    }\n\n    function onProgress(e) {\n      handleProgress();\n      assets[name] = asset;\n      if (e.lengthComputable) {\n        loader.progress = Math.max(loader.progress, e.loaded / e.total);\n      } else {\n        loader.progress = 0.75 * loader.progress + 0.25;\n      }\n      notifyProgress(name);\n    }\n\n    function onComplete() {\n      handleProgress();\n      if (loader.state === STATE_DATA) {\n        if (parser.done) {\n          try {\n            asset = parser.done();\n          } catch (e) {\n            return abort(e);\n          }\n        }\n        loader.state = STATE_COMPLETE;\n      }\n      loader.progress = 1;\n      loader.ready = true;\n      assets[name] = asset;\n      removeListeners();\n      notifyProgress('finish ' + name);\n    }\n\n    function onError() {\n      abort('error loading asset \"' + name + '\"');\n    }\n\n    if (request.stream) {\n      element.addEventListener('progress', onProgress);\n    }\n    if (request.type === 'image') {\n      element.addEventListener('load', onComplete);\n    } else {\n      let canPlay = false;\n      let loadedMetaData = false;\n      element.addEventListener('loadedmetadata', function () {\n        loadedMetaData = true;\n        if (canPlay) {\n          onComplete();\n        }\n      });\n      element.addEventListener('canplay', function () {\n        canPlay = true;\n        if (loadedMetaData) {\n          onComplete();\n        }\n      });\n    }\n    element.addEventListener('error', onError);\n\n    function removeListeners() {\n      if (request.stream) {\n        element.removeEventListener('progress', onProgress);\n      }\n      if (request.type === 'image') {\n        element.addEventListener('load', onComplete);\n      } else {\n        element.addEventListener('canplay', onComplete);\n      }\n      element.removeEventListener('error', onError);\n    }\n\n    function cancel() {\n      if (loader.state === STATE_COMPLETE || loader.state === STATE_ERROR) {\n        return;\n      }\n\n      loader.state = STATE_ERROR;\n      removeListeners();\n      element.src = '';\n    }\n\n    // set up request\n    if (request.credentials) {\n      element.crossOrigin = 'use-credentials';\n    } else {\n      element.crossOrigin = 'anonymous';\n    }\n    element.src = request.src;\n\n    return loader;\n  }\n\n  let loaders = {\n    text: loadXHR,\n    binary: function (request) {\n      // TODO use fetch API for streaming if supported\n      return loadXHR(request);\n    },\n    image: function (request) {\n      return loadElement(request, document.createElement('img'));\n    },\n    video: function (request) {\n      return loadElement(request, document.createElement('video'));\n    },\n    audio: function (request) {\n      return loadElement(request, document.createElement('audio'));\n    }\n  };\n\n  // First we parse all objects in order to verify that all type information\n  // is correct\n  let pending = Object.keys(manifest).map(function (name) {\n    let request = manifest[name];\n    if (typeof request === 'string') {\n      request = {\n        src: request\n      };\n    } else if (typeof request !== 'object' || !request) {\n      raise('invalid asset definition \"' + name + '\"');\n    }\n\n    checkType(request, manifestParameters, 'asset \"' + name + '\"');\n\n    function getParameter(prop, accepted, init) {\n      let value = init;\n      if (prop in request) {\n        value = request[prop];\n      }\n      if (accepted.indexOf(value) < 0) {\n        raise('invalid ' + prop + ' \"' + value + '\" for asset \"' + name + '\", possible values: ' + accepted);\n      }\n      return value;\n    }\n\n    function getString(prop, required, init) {\n      let value = init;\n      if (prop in request) {\n        value = request[prop];\n      } else if (required) {\n        raise('missing ' + prop + ' for asset \"' + name + '\"');\n      }\n      if (typeof value !== 'string') {\n        raise('invalid ' + prop + ' for asset \"' + name + '\", must be a string');\n      }\n      return value;\n    }\n\n    function getParseFunc(name, dflt) {\n      if (name in request.parser) {\n        let result = request.parser[name];\n        if (typeof result !== 'function') {\n          raise('invalid parser callback ' + name + ' for asset \"' + name + '\"');\n        }\n        return result;\n      } else {\n        return dflt;\n      }\n    }\n\n    let parser = {};\n    if ('parser' in request) {\n      if (typeof request.parser === 'function') {\n        parser = {\n          data: request.parser\n        };\n      } else if (typeof request.parser === 'object' && request.parser) {\n        checkType(request.parser, parserParameters, 'parser for asset \"' + name + '\"');\n        if (!('onData' in request.parser)) {\n          raise('missing onData callback for parser in asset \"' + name + '\"');\n        }\n        parser = {\n          data: getParseFunc('onData'),\n          done: getParseFunc('onDone')\n        };\n      } else {\n        raise('invalid parser for asset \"' + name + '\"');\n      }\n    }\n\n    return {\n      name: name,\n      type: getParameter('type', Object.keys(loaders), 'text'),\n      stream: !!request.stream,\n      credentials: !!request.credentials,\n      src: getString('src', true, ''),\n      parser: parser\n    };\n  }).map(function (request) {\n    return (loaders[request.type])(request);\n  });\n\n  function abort(message) {\n    if (state === STATE_ERROR || state === STATE_COMPLETE) {\n      return;\n    }\n    state = STATE_ERROR;\n    pending.forEach(function (loader) {\n      loader.cancel();\n    });\n    if (onError) {\n      if (typeof message === 'string') {\n        onError(new Error('resl: ' + message));\n      } else {\n        onError(message);\n      }\n    } else {\n      console.error('resl error:', message);\n    }\n  }\n\n  function notifyProgress(message) {\n    if (state === STATE_ERROR || state === STATE_COMPLETE) {\n      return;\n    }\n\n    let progress = 0;\n    let numReady = 0;\n    pending.forEach(function (loader) {\n      if (loader.ready) {\n        numReady += 1;\n      }\n      progress += loader.progress;\n    });\n\n    if (numReady === pending.length) {\n      state = STATE_COMPLETE;\n      onDone(assets);\n    } else {\n      if (onProgress) {\n        onProgress(progress / pending.length, message);\n      }\n    }\n  }\n\n  if (pending.length === 0) {\n    setTimeout(function () {\n      notifyProgress('done');\n    }, 1);\n  }\n}","export default {\n  // ========================\n  // diffuse\n  // ========================\n\n  diffuse: {\n    attributes: [\n      'a_position',\n      'a_normal',\n      'a_uv0'\n    ],\n    vertexShader: `\n      precision mediump float;\n      uniform mat4 model, view, projection;\n\n      attribute vec3 a_position;\n      attribute vec3 a_normal;\n      attribute vec2 a_uv0;\n\n      varying vec2 v_uv0;\n\n      void main() {\n        v_uv0 = a_uv0;\n        gl_Position = projection * view * model * vec4(a_position, 1);\n      }\n    `,\n    fragmentShader: `\n      #extension GL_OES_standard_derivatives : enable\n\n      precision mediump float;\n      uniform sampler2D u_mainTexture;\n      uniform vec2 u_mainTextureTiling;\n      uniform vec2 u_mainTextureOffset;\n\n      varying vec2 v_uv0;\n\n      void main () {\n        // gl_FragColor = vec4( 1, 1, 1, 1 );\n        // gl_FragColor = vec4( v_uv0.x, v_uv0.y, 0, 1 );\n\n        vec2 uv0 = v_uv0 * u_mainTextureTiling + u_mainTextureOffset;\n\n        gl_FragColor = texture2D( u_mainTexture, uv0 );\n\n        if (!gl_FrontFacing) {\n          gl_FragColor *= 0.05;\n        }\n      }\n    `,\n  },\n\n  // ========================\n  // diffuse_skinning\n  // ========================\n\n  diffuse_skinning: {\n    attributes: [\n      'a_position',\n      'a_normal',\n      'a_uv0',\n      'a_joint',\n      'a_weight'\n    ],\n    vertexShader: `\n      precision mediump float;\n      uniform mat4 model, view, projection;\n\n      attribute vec3 a_position;\n      attribute vec3 a_normal;\n      attribute vec2 a_uv0;\n      attribute vec4 a_weight;\n      attribute vec4 a_joint;\n\n      uniform sampler2D u_bonesTexture;\n      uniform float u_bonesTextureSize;\n\n      varying vec2 v_uv0;\n\n      mat4 getBoneMatrix(const in float i) {\n        float size = u_bonesTextureSize;\n        float j = i * 4.0;\n        float x = mod(j, size);\n        float y = floor(j / size);\n\n        float dx = 1.0 / size;\n        float dy = 1.0 / size;\n\n        y = dy * (y + 0.5);\n\n        vec4 v1 = texture2D(u_bonesTexture, vec2(dx * (x + 0.5), y));\n        vec4 v2 = texture2D(u_bonesTexture, vec2(dx * (x + 1.5), y));\n        vec4 v3 = texture2D(u_bonesTexture, vec2(dx * (x + 2.5), y));\n        vec4 v4 = texture2D(u_bonesTexture, vec2(dx * (x + 3.5), y));\n\n        mat4 bone = mat4(v1, v2, v3, v4);\n\n        return bone;\n      }\n\n      void main() {\n        v_uv0 = a_uv0;\n        mat4 matSkin =\n          getBoneMatrix(a_joint.x) * a_weight.x +\n          getBoneMatrix(a_joint.y) * a_weight.y +\n          getBoneMatrix(a_joint.z) * a_weight.z +\n          getBoneMatrix(a_joint.w) * a_weight.w ;\n\n        gl_Position = projection * view * model * matSkin * vec4(a_position, 1);\n      }\n    `,\n    fragmentShader: `\n      #extension GL_OES_standard_derivatives : enable\n\n      precision mediump float;\n      uniform sampler2D u_mainTexture;\n\n      varying vec2 v_uv0;\n\n      void main () {\n        // gl_FragColor = vec4( 1, 1, 1, 1 );\n        // gl_FragColor = vec4( v_uv0.x, v_uv0.y, 0, 1 );\n\n        gl_FragColor = texture2D( u_mainTexture, v_uv0 );\n\n        if (!gl_FrontFacing) {\n          gl_FragColor *= 0.05;\n        }\n      }\n    `,\n  }\n};","const GL = WebGLRenderingContext.prototype;\n\nexport default {\n  diffuse: {\n    name: 'diffuse',\n    program: 'diffuse',\n    parameters: {\n      position: {\n        type: GL.FLOAT_VEC3,\n        semantic: 'POSITION'\n      },\n      normal: {\n        type: GL.FLOAT_VEC3,\n        semantic: 'NORMAL'\n      },\n      uv0: {\n        type: GL.FLOAT_VEC2,\n        semantic: 'TEXCOORD_0'\n      },\n      model: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'MODEL'\n      },\n      view: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'VIEW'\n      },\n      projection: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'PROJECTION'\n      },\n      mainTexture: {\n        type: GL.SAMPLER_2D,\n      },\n      mainTextureTiling: {\n        type: GL.FLOAT_VEC2,\n      },\n      mainTextureOffset: {\n        type: GL.FLOAT_VEC2,\n      },\n    },\n\n    attributes: {\n      a_position: 'position',\n      a_normal: 'normal',\n      a_uv0: 'uv0',\n    },\n\n    uniforms: {\n      model: 'model',\n      // view: 'view',\n      // projection: 'projection',\n      u_mainTexture: 'mainTexture',\n      u_mainTextureTiling: 'mainTextureTiling',\n      u_mainTextureOffset: 'mainTextureOffset',\n    },\n  },\n\n  diffuse_skinning: {\n    name: 'diffuse_skinning',\n    program: 'diffuse_skinning',\n    parameters: {\n      position: {\n        type: GL.FLOAT_VEC3,\n        semantic: 'POSITION'\n      },\n      normal: {\n        type: GL.FLOAT_VEC3,\n        semantic: 'NORMAL'\n      },\n      uv0: {\n        type: GL.FLOAT_VEC2,\n        semantic: 'TEXCOORD_0'\n      },\n      joint: {\n        type: GL.FLOAT_VEC4,\n        semantic: 'JOINT'\n      },\n      weight: {\n        type: GL.FLOAT_VEC4,\n        semantic: 'WEIGHT'\n      },\n      model: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'MODEL'\n      },\n      view: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'VIEW'\n      },\n      projection: {\n        type: GL.FLOAT_MAT4,\n        semantic: 'PROJECTION'\n      },\n      mainTexture: {\n        type: GL.SAMPLER_2D,\n      },\n      bonesTexture: {\n        type: GL.SAMPLER_2D,\n      },\n      bonesTextureSize: {\n        type: GL.FLOAT,\n      },\n    },\n\n    attributes: {\n      a_position: 'position',\n      a_normal: 'normal',\n      a_uv0: 'uv0',\n      a_joint: 'joint',\n      a_weight: 'weight',\n    },\n\n    uniforms: {\n      model: 'model',\n      // view: 'view',\n      // projection: 'projection',\n      u_bonesTexture: 'bonesTexture',\n      u_bonesTextureSize: 'bonesTextureSize',\n      u_mainTexture: 'mainTexture',\n    },\n  },\n};","import {Node, utils} from 'scene-graph';\nimport {vec3, quat} from 'vmath';\n\nimport resl from './resl';\nimport builtinPrograms from './builtin-programs';\nimport builtinTechniques from './builtin-techniques';\n\nlet _programs = {};\nfor (let name in builtinPrograms) {\n  _programs[name] = builtinPrograms[name];\n}\n\nlet _techniques = {};\nfor (let name in builtinTechniques) {\n  _techniques[name] = builtinTechniques[name];\n}\n\nfunction _walk(scene, fn) {\n  scene.nodes.forEach(node => {\n    fn(node);\n    utils.walk(node, child => {\n      fn(child);\n    });\n  });\n}\n\nfunction _replace(scene, oldNode, newNode) {\n  if (oldNode._parent) {\n    return utils.replace(oldNode, newNode);\n  }\n\n  for (let i = 0; i < scene.nodes.length; ++i) {\n    if (scene.nodes[i] === oldNode) {\n      scene.nodes[i] = newNode;\n      return;\n    }\n  }\n}\n\nfunction _serializeCommands(regl, json, commands) {\n  for ( let techID in _techniques ) {\n    let gltfTechnique = _techniques[techID];\n    let gltfProgram = _programs[gltfTechnique.program];\n\n    // draw options\n    let opts = {\n      // frontFace: 'ccw',\n      cull: {\n        enable: true,\n        face: 'back'\n      },\n\n      vert: gltfProgram.vertexShader,\n      frag: gltfProgram.fragmentShader,\n\n      primitive: regl.prop('primitive'),\n      offset: regl.prop('offset'),\n      count: regl.prop('count'),\n\n      elements: regl.prop('elements'),\n      attributes: {},\n      uniforms: {},\n    };\n    for (let attrName in gltfTechnique.attributes) {\n      opts.attributes[attrName] = regl.prop(`attributes.${attrName}`);\n    }\n    for (let uniformName in gltfTechnique.uniforms) {\n      opts.uniforms[uniformName] = regl.prop(`uniforms.${uniformName}`);\n    }\n    // TODO: states\n    // TODO: functions\n\n    // finalize\n    commands[techID] = regl(opts);\n  }\n}\n\nfunction _serializeNodes(json, parent, childrenIDs, out) {\n  childrenIDs.forEach(nodeID => {\n    let gltfNode = json.nodes[nodeID];\n    let node = new Node(gltfNode.name);\n    let data;\n\n    node._id = nodeID;\n    node._parent = parent;\n\n    data = gltfNode.translation;\n    node.lpos = data ?\n      vec3.new(data[0], data[1], data[2]) :\n      vec3.new(0, 0, 0)\n      ;\n\n    data = gltfNode.rotation;\n    node.lrot = data ?\n      quat.new(data[0], data[1], data[2], data[3]) :\n      quat.new(0, 0, 0, 1)\n      ;\n\n    data = gltfNode.scale;\n    node.lscale = data ?\n      vec3.new(data[0], data[1], data[2]) :\n      vec3.new(1, 1, 1)\n      ;\n\n    node._meshes = gltfNode.meshes;\n    node._skeletons = gltfNode.skeletons;\n    node._skin = gltfNode.skin;\n    node._extras = gltfNode.extras;\n\n    if (gltfNode.children) {\n      _serializeNodes(json, node, gltfNode.children, node.children);\n    }\n\n    out.push(node);\n  });\n\n  return out;\n}\n\nfunction _serializeJoint(json, parent, id, joints) {\n  let node = joints[id];\n  if (node) {\n    if (parent) {\n      node._parent = parent;\n      parent.children.push(node);\n    }\n\n    return;\n  }\n\n  let gltfNode = json.nodes[id];\n  node = new Node(gltfNode.name);\n\n  node._id = id;\n  node._parent = parent;\n\n  let data;\n  data = gltfNode.translation;\n  node.lpos = data ?\n    vec3.new(data[0], data[1], data[2]) :\n    vec3.new(0, 0, 0)\n    ;\n\n  data = gltfNode.rotation;\n  node.lrot = data ?\n    quat.new(data[0], data[1], data[2], data[3]) :\n    quat.new(0, 0, 0, 1)\n    ;\n\n  data = gltfNode.scale;\n  node.lscale = data ?\n    vec3.new(data[0], data[1], data[2]) :\n    vec3.new(1, 1, 1)\n    ;\n\n  joints[id] = node;\n\n  if (parent) {\n    parent.children.push(node);\n  }\n\n  if (gltfNode.children) {\n    gltfNode.children.forEach(childNodeID => {\n      _serializeJoint(json, node, childNodeID, joints);\n    });\n  }\n}\n\nfunction _serializeTextures(regl, json, textures, callback) {\n  let manifest = {};\n\n  for ( let name in json.textures ) {\n    let gltfTexture = json.textures[name];\n    let gltfImage = json.images[gltfTexture.source];\n    // TODO:\n    // let gltfSampler = json.sampler[gltfTexture.sampler];\n\n    textures[name] = regl.texture();\n    manifest[name] = {\n      type: 'image',\n      src: `${json.baseURL}/${gltfImage.uri}`\n    };\n  }\n\n  resl({\n    manifest,\n    onError(err) {\n      console.error(err);\n    },\n    onDone(assets) {\n      for (let name in assets) {\n        textures[name]({\n          data: assets[name],\n          wrapS: 'repeat',\n          wrapT: 'repeat',\n          mag: 'linear',\n          min: 'mipmap',\n          mipmap: 'nice',\n          flipY: true\n        });\n      }\n\n      if (callback) {\n        callback(null, textures);\n      }\n    },\n  });\n}\n\nfunction _serializeBuffers(regl, json, buffers, callback) {\n  let manifest = {};\n  let buffer2viewIDs = {};\n\n  for ( let id in json.buffers ) {\n    let gltfBuffer = json.buffers[id];\n    manifest[id] = {\n      type: 'binary',\n      src: `${json.baseURL}/${gltfBuffer.uri}`\n    };\n    buffer2viewIDs[id] = [];\n  }\n\n  for ( let id in json.bufferViews ) {\n    let gltfBufferView = json.bufferViews[id];\n    if ( gltfBufferView.target === regl._gl.ARRAY_BUFFER ) {\n      buffers[id] = regl.buffer(gltfBufferView.byteLength);\n    } else if ( gltfBufferView.target === regl._gl.ELEMENT_ARRAY_BUFFER ) {\n      buffers[id] = regl.elements(gltfBufferView.byteLength);\n    } else {\n      buffers[id] = new ArrayBuffer();\n    }\n\n    buffer2viewIDs[gltfBufferView.buffer].push(id);\n  }\n\n  resl({\n    manifest,\n    onError(err) {\n      console.error(err);\n    },\n    onDone(assets) {\n      for ( let id in assets ) {\n        let viewIDs = buffer2viewIDs[id];\n        viewIDs.forEach(viewID => {\n          let gltfBufferView = json.bufferViews[viewID];\n          if ( gltfBufferView.target ) {\n            let reglBuf = buffers[viewID];\n            reglBuf({\n              type: 'uint16', // HACK\n              data: new Uint8Array(assets[id], gltfBufferView.byteOffset, gltfBufferView.byteLength)\n            });\n          } else {\n            // ArrayBuffer.slice\n            buffers[viewID] = assets[id].slice(\n              gltfBufferView.byteOffset,\n              gltfBufferView.byteOffset + gltfBufferView.byteLength\n            );\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, buffers);\n      }\n    }\n  });\n}\n\nfunction _serializePrefabs(regl, json, scene, prefabs, callback) {\n  if (!json.extras || !json.extras.prefabs) {\n    if (callback) {\n      callback(null, prefabs);\n    }\n\n    return;\n  }\n\n  let count = 0;\n  let manifest = {};\n  for (let id in json.extras.prefabs) {\n    let asset = json.extras.prefabs[id];\n    manifest[id] = {\n      type: 'text',\n      src: `${json.baseURL}/${asset.uri}`,\n      parser: JSON.parse\n    };\n    ++count;\n  }\n\n  resl({\n    manifest,\n    onError(err) {\n      console.error(err);\n    },\n    onDone(assets) {\n      for ( let id in assets ) {\n        let url = manifest[id].src;\n        let prefabJson = assets[id];\n\n        let idx = url.lastIndexOf('/');\n        if (idx !== -1) {\n          prefabJson.baseURL = url.substring(0, idx);\n        } else {\n          prefabJson.baseURL = url;\n        }\n\n        _serializeGLTF(regl, prefabJson, scene, (err, result) => {\n          prefabs[id] = result;\n\n          --count;\n          if (count === 0 && callback) {\n            callback(null, prefabs);\n          }\n        });\n      }\n    }\n  });\n}\n\nfunction _serializeGLTF(regl, json, scene, callback) {\n  let gltfScene = json.scenes[json.scene];\n  let result = {\n    name: gltfScene.name,\n    json: json,\n    nodes: [],\n    joints: {},\n  };\n\n  // update programs & techinques\n  for (let name in json.programs) {\n    _programs[name] = json.programs[name];\n  }\n  for ( let name in json.techniques ) {\n    _techniques[name] = json.techniques[name];\n  }\n\n  // serialize gltf globally\n  scene.programs = _programs;\n  scene.techniques = _techniques;\n  for ( let id in json.meshes ) {\n    scene.meshes[id] = json.meshes[id];\n  }\n  for ( let id in json.materials ) {\n    scene.materials[id] = json.materials[id];\n  }\n  for ( let id in json.accessors ) {\n    scene.accessors[id] = json.accessors[id];\n  }\n\n  // serialize commands\n  _serializeCommands(regl, json, scene.commands);\n\n  // serialize nodes\n  _serializeNodes(json, null, gltfScene.nodes, result.nodes);\n\n  // serialize joints\n  for (let id in json.nodes) {\n    let node = json.nodes[id];\n    if (node.jointName) {\n      _serializeJoint(json, null, id, result.joints);\n    }\n  }\n\n  // serialize textures\n  _serializeTextures(regl, json, scene.textures);\n\n  // serialize buffers\n  _serializeBuffers(regl, json, scene.buffers);\n\n  // serialize extras.prefabs\n  _serializePrefabs(regl, json, scene, scene.prefabs, (err, prefabs) => {\n    _walk(result, child => {\n      if (child._extras && child._extras.prefab) {\n        let prefabID = child._extras.prefab;\n        let prefab = prefabs[prefabID];\n        let root = prefab.nodes[0];\n        let prefabNode = root.deepClone((newNode, oldNode) => {\n          newNode._meshes = oldNode._meshes;\n          newNode._skeletons = oldNode._skeletons;\n          newNode._skin = oldNode._skin;\n          newNode._extras = oldNode._extras;\n        });\n        vec3.copy(prefabNode.lpos, child.lpos);\n        vec3.copy(prefabNode.lscale, child.lscale);\n        quat.copy(prefabNode.lrot, child.lrot);\n\n        _replace(result, child, prefabNode);\n\n        scene._dirty = true;\n      }\n    });\n  });\n\n  // done\n  callback(null, result);\n}\n\nexport default function load (regl, url, callback) {\n  resl({\n    manifest: {\n      json: {\n        type: 'text',\n        src: url,\n        parser: JSON.parse\n      }\n    },\n\n    onDone(assets) {\n      let idx = url.lastIndexOf('/');\n      if (idx !== -1) {\n        assets.json.baseURL = url.substring(0,idx);\n      } else {\n        assets.json.baseURL = url;\n      }\n\n      let scene = {\n        _dirty: false,\n\n        //\n        name: '',\n        json: '',\n        nodes: [],\n        joints: {},\n\n        // gltf (global)\n        techniques: {},\n        programs: {},\n        meshes: {},\n        materials: {},\n        accessors: {},\n\n        // resources\n        textures: {}, // texture id to regl texture\n        buffers: {},  // buffer-view id to regl buffer\n        prefabs: {}, // serialized prefabs\n        commands: {}, // technique id to regl command\n      };\n      _serializeGLTF(regl, assets.json, scene, (err,result) => {\n        scene.name = result.name;\n        scene.json = result.json;\n        scene.nodes = result.nodes;\n        scene.joints = result.joints;\n\n        if (callback) {\n          callback(null, scene);\n        }\n      });\n    },\n\n    onError(err) {\n      console.error(err);\n      callback(err);\n    }\n  });\n}","import {mat4} from 'vmath';\nimport { f32a_m4_pool } from './pools';\n\nconst GL = WebGLRenderingContext.prototype;\nlet m4_a = mat4.create();\n\nfunction _type2buffersize(type) {\n  if (type === 'SCALAR') {\n    return 1;\n  } else if (type === 'VEC2') {\n    return 2;\n  } else if (type === 'VEC3') {\n    return 3;\n  } else if (type === 'VEC4') {\n    return 4;\n  } else if (type === 'MAT2') {\n    return 4;\n  } else if (type === 'MAT3') {\n    return 9;\n  } else if (type === 'MAT4') {\n    return 16;\n  }\n\n  return 1;\n}\n\nfunction _mode2primitive(mode) {\n  if (mode === GL.POINTS) {\n    return 'points';\n  } else if (mode === GL.LINES) {\n    return 'lines';\n  } else if (mode === GL.LINE_LOOP) {\n    return 'line loop';\n  } else if (mode === GL.LINE_STRIP) {\n    return 'line strip';\n  } else if (mode === GL.TRIANGLES) {\n    return 'triangles';\n  } else if (mode === GL.TRIANGLE_STRIP) {\n    return 'triangle strip';\n  } else if (mode === GL.TRIANGLE_FAN) {\n    return 'triangle fan';\n  }\n\n  return 'triangles';\n}\n\nexport default function buildCommandData(scene, node, gltfPrimitive) {\n  // get material & technique\n  let gltfMaterial = scene.materials[gltfPrimitive.material];\n  // let techID = useSkin ? gltfMaterial.technique + '_skinning' : gltfMaterial.technique;\n  let techID = gltfMaterial.technique;\n  let tech = scene.techniques[techID];\n  let program = scene.programs[tech.program];\n\n  let data = {\n    techID: techID,\n    primitive: _mode2primitive(gltfPrimitive.mode),\n    attributes: {},\n    uniforms: {},\n  };\n\n  // get attribute accessor\n  program.attributes.forEach(attrName => {\n    let paramName = tech.attributes[attrName];\n    let param = tech.parameters[paramName];\n    let accessorID = gltfPrimitive.attributes[param.semantic];\n    if (!accessorID) {\n      console.warn(`can not find attribute by semantic ${param.semantic}`);\n      return;\n    }\n\n    let accessor = scene.accessors[accessorID];\n    data.attributes[attrName] = {\n      buffer: scene.buffers[accessor.bufferView],\n      offset: accessor.byteOffset,\n      stride: accessor.byteStride,\n      // type: _type2buffertype(accessor.componentType),\n      type: accessor.componentType,\n      size: _type2buffersize(accessor.type),\n    };\n  });\n\n  // get uniforms\n  for (let name in tech.uniforms) {\n    let paramName = tech.uniforms[name];\n    let param = tech.parameters[paramName];\n\n    let value = gltfMaterial.values[paramName];\n    if (value !== undefined) {\n      if (param.type === GL.SAMPLER_2D) {\n        data.uniforms[name] = scene.textures[value];\n      } else {\n        data.uniforms[name] = value;\n      }\n      continue;\n    }\n\n    // use default value\n    if (param.value !== undefined) {\n      if (param.type === GL.SAMPLER_2D) {\n        data.uniforms[name] = scene.textures[param.value];\n      } else {\n        data.uniforms[name] = value;\n      }\n    }\n  }\n\n  // get indices accessor\n  if (gltfPrimitive.indices) {\n    let accessor = scene.accessors[gltfPrimitive.indices];\n    data.elements = scene.buffers[accessor.bufferView];\n    data.offset = accessor.byteOffset;\n    data.count = accessor.count;\n  }\n\n  // TODO: states\n\n  // node uniforms\n  node.getWorldMatrix(m4_a);\n  data.uniforms.model = mat4.array(f32a_m4_pool.alloc(), m4_a);\n\n  // if (bonesTexture) {\n  //   info.uniforms.u_bonesTexture = bonesTexture;\n  //   info.uniforms.u_bonesTextureSize = bonesTexture.width;\n  // }\n\n  return data;\n}","import { f32a_m4_pool } from './lib/pools';\nexport { default as load } from './lib/loader';\nexport { default as buildCommandData } from './lib/build-cmd-data';\n\nexport function reset() {\n  f32a_m4_pool.reset();\n}"],"names":["FramePool","utils","Node","vec3","quat","GL","mat4"],"mappings":"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"}